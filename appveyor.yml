version: 3.1.0.{build}
image: Visual Studio 2022
skip_non_tags: true

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: "{version}"
  package_version: "{version}"
  assembly_version: "{version}"
  file_version: "{version}"
  informational_version: "{version}"

before_build:
  - ps: >-
      nuget restore

build:
  project: C:\projects\dotfeather\src\dotfeather.csproj
  publish_nuget: true

configuration: Release

after_build:
  - nuget pack -Prop Configuration=Release src -OutputDirectory src/bin/Release/

artifacts:
  - path: '**\*.nupkg'
    name: DotFeather

deploy:
  - provider: NuGet
    api_key:
      # Use encrypt tool
      # https://ci.appveyor.com/tools/encrypt
      secure: 1k6f11E9bN8eBIzSz4tDjART0Nk5agF+JvR85X+w8Lb8GgJSJTr2uPlZrM+TyIja
    artifact: /.*\.nupkg/
    on:
      appveyor_repo_tag: true
  - provider: GitHub
    artifact: /.*\.nupkg/ # upload all NuGet packages to release assets
    draft: false
    prerelease: true
    description: |
      # 3.1.0-beta.2

      ## 追加
      * `DFMouse` にイベントを追加
        * Click - クリックした
        * ButtonDown - ボタンを押した
        * ButtonUp - ボタンを離した
        * Move - カーソルが移動した
        * Enter - カーソルがウィンドウに入った
        * Leave - カーソルがウィンドウから離れた
      * Vector型に、指定した矩形領域に接しているかを計算する `In()` メソッドを追加

      ## 変更
      * Disposeされたテクスチャを描画しようと試みた場合、警告を発生させるように
      * `DF.Window.FollowsDpi` プロパティを非推奨に
      * `DF.Window.ActualSize`, `ActualWidth`, `ActualHeight` プロパティへの設定を非推奨に

      ## 3.1.0-beta.1 からの改善・修正された不具合
      * 高解像度ディスプレイでの挙動を改善
      * Graphic: `ShapeType.Rect` を描画できない問題を修正
      * `DF.Window.IsFocused` が機能していない問題を修正

      ## 3.0.0 から修正された不具合
      * コンソールが見切れる不具合を修正

      ## 既知の不具合
      * Texture: 特定の状況で大量のテクスチャを読み込んだ際に、途中でテクスチャを正常に読み込めなくなる
      * Graphic: ShapeType.Polygon を描画できない
      * Audio: 停止にラグがある
      * Input: macOSで日本語入力をすると、入力文字列よりも前に改行が挿入される

    auth_token:
      secure: FUlGF4CyRZNM6jaGz2wlmsOIwZt4av2Cxn4lHbi5wU5lim3FixH9ZIhLGDRZftOx
    on:
      APPVEYOR_REPO_TAG: true # deploy on tag push only
